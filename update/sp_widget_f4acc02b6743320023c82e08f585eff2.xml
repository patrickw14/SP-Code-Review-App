<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <async>false</async>
        <background_image/>
        <client_script><![CDATA[function(spUtil, $scope) {
  /* widget controller */
  var c = this;
	
	spUtil.recordWatch($scope, "sn_codereview_reviewer", "", function(name, data) {
		c.server.update();
	});
	
	spUtil.recordWatch($scope, "sn_codereview_review", "", function(name, data) {
		c.server.update();
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>// ----------------------------------------------------------------------------
// Sass declarations
// ----------------------------------------------------------------------------
$background-color:  #2A2A2A;
$value-color:       #fff;

$title-color:       rgba(255, 255, 255, 0.7);
$moreinfo-color:    rgba(255, 255, 255, 0.7);

// Colors
$color-purple: #6d79e8;
$color-purple-light: #a0a8f1;
$color-purple-lighter: #c6c9f6;

$color-blue: #278efc;
$color-blue-light: #83bfff;
$color-blue-lighter: #bddcfc;

$color-aqua: #19c4d1;
$color-aqua-light: #68d9e1;
$color-aqua-lighter: #a3e6ee;

$color-cyan: #289fbd;
$color-cyan-light: #74c2e8;
$color-cyan-lighter: #a9d9f0;

$color-green: #71e279;
$color-green-light: #a4eda8;
$color-green-lighter: #d3f6d6;

$color-yellow: #fcc742;
$color-yellow-light: #ffdb85;
$color-yellow-lighter: #fdeec5;

$color-orange: #fc8a3d;
$color-orange-light: #fdb481;
$color-orange-lighter: #ffdcc6;

$color-red: #f95050;
$color-red-light: #fb8d8e;
$color-red-lighter: #fccac9;

$color-pink: #f95070;
$color-pink-light: #fa8da2;
$color-pink-lighter: #fecad6;

$color-chocolate: #d2691e;
$color-chocolate-light: #eca979;
$color-chocolate-lighter: #fcf1e9;

$color-map: $color-yellow,
            $color-blue,
            $color-green,
            $color-purple,
            $color-chocolate;

h1 {
  text-align: center;
  font-size: 66px; 
}

h2 {
  text-align: center;
  font-size: 50px;
}

h3 {
  color: $title-color;
  text-align: left;
  font-size: 2.2em;
  background-color: #222222;
  display: block;
  width: 100%;
  padding: 10px 0;
  border-bottom: solid 1px rgba(0, 0, 0, 0.3);
  -webkit-box-shadow: 0px 2px 1px 0px rgba(255,255,255,0.10);
  box-shadow: 0px 1px 1px 0px rgba(255,255,255,0.10);
  margin: 0;
  padding-left: 5px;
  padding-right: 5px;
}

.task {
  padding: 10px;
  border-bottom: solid 1px rgba(0, 0, 0, 0.3);
	position: relative;
  
  a {
    font-size: 25px;
  }
  
  .task-description {
    font-size: 15px;
  }
  
  .task-branch {
    font-weight: bold;
  }
  
  .task-author {
    font-style: italic;
  }
  
  .task-age {
    font-style: italic;
    color: #BDC0C4;
  }
  
  .urgency-bar {
    top: 0;
    left: 0;
    position: absolute;
    border-bottom-left-radius: 2px;
    border-top-left-radius: 2px;
    height: 100%;
    width: 5px;
    margin: 0;
    
    &amp;.medium-urgency {
      background-color: $color-yellow;
    }
    
    &amp;.high-urgency {
      background-color: $color-red;
    }
  }
}

.column-container {
  margin-top: 30px;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: row /* works with row or column */
    flex-direction: row;
  -webkit-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  justify-content: center;

  .column {
    flex: 1 1 auto;
    max-width: 300px;
    background-color: $background-color;
    margin-left: 10px;
    margin-right: 10px;
  }
}

.empty-task-message {
  text-align: center;
  font-size: 40px;
}

.activity-stream {
	position: absolute;
  width: 400px;
  top: 0;
  right: 0;
}</css>
        <customer_update>false</customer_update>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <documentation/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>code_review_dash</id>
        <internal>false</internal>
        <link/>
        <name>Code Review Dash</name>
        <option_schema/>
        <public>false</public>
        <replace_on_upgrade>false</replace_on_upgrade>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	data.reviews = {
		"Unassigned": []
	};
	// Let's start with getting unassigned reviews.
	var assignedReviewIDs = [];
	var assignmentsGR = new GlideRecord("sn_codereview_reviewer");
	assignmentsGR.query();
	while(assignmentsGR.next())
		assignedReviewIDs.push(assignmentsGR.getValue("review"));
	
	//console.log(assignedReviewIDs);
	
	var unassignedReviewGR = new GlideRecord("sn_codereview_review");
	unassignedReviewGR.addQuery("sys_id", "NOT IN", assignedReviewIDs);
	unassignedReviewGR.addActiveQuery();
	unassignedReviewGR.addQuery("state", "open");
	unassignedReviewGR.query();
	while(unassignedReviewGR.next())
		data.reviews["Unassigned"].push({
			description: unassignedReviewGR.getValue("description"),
			author: unassignedReviewGR.getDisplayValue("owner"),
			branch: unassignedReviewGR.getValue("branch")
		});
	
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2017-06-05 07:04:59</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>f4acc02b6743320023c82e08f585eff2</sys_id>
        <sys_mod_count>17</sys_mod_count>
        <sys_name>Code Review Dash</sys_name>
        <sys_package display_value="CodeReview" source="sn_codereview">8d80e4fd6722320023c82e08f585ef22</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="CodeReview">8d80e4fd6722320023c82e08f585ef22</sys_scope>
        <sys_update_name>sp_widget_f4acc02b6743320023c82e08f585eff2</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2017-06-05 15:48:07</sys_updated_on>
        <template><![CDATA[<div class="widget-contents">
  <h1>Code Reviews</h1>
  
  <div class="column-container">
    <div class="column" ng-repeat="(category, reviewList) in c.data.reviews">
      <h2>{{category}}</h2>
      <div class="task" ng-repeat="review in reviewList">
        <div class="task-description">{{review.description}}</div>
        <div class="task-branch">{{review.branch}}</div>
        <div class="task-author">By {{review.author}}</div>
      </div>
      <h3 ng-if="reviewList.length == 0">
        Nothing here.
      </h3>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
